{"componentChunkName":"component---src-templates-blog-post-js","path":"/archives/2018-05-20-mysql-transaction/","result":{"data":{"site":{"siteMetadata":{"title":"Alvie's Blog"}},"markdownRemark":{"id":"b8aa4f4c-94e5-564e-8846-3ca9414185a3","excerpt":"控制事务的语句  或者  开启一个新的事务  提交当前事物，使变更持久化  回滚当前事物，取消所做出的变动  设置当前会话禁用或者启用自动提交 默认情况下，MySQL 的 autocommit…","html":"<h2>控制事务的语句</h2>\n<ul>\n<li><code class=\"language-text\">START TRANSACTION</code> 或者 <code class=\"language-text\">BEGIN</code> 开启一个新的事务</li>\n<li><code class=\"language-text\">COMMIT</code> 提交当前事物，使变更持久化</li>\n<li><code class=\"language-text\">ROLLBACK</code> 回滚当前事物，取消所做出的变动</li>\n<li><code class=\"language-text\">SET autocommit</code> 设置当前会话禁用或者启用自动提交</li>\n</ul>\n<p>默认情况下，MySQL 的 autocommit 设置为启用，也就是说所有语句产生的变动都会自动地提交到数据库中，无法回滚。</p>\n<h2>如何启用事务？</h2>\n<h3>使用 <code class=\"language-text\">START TRANSACTION</code> 或 <code class=\"language-text\">BEGIN</code> 语句</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">START</span> <span class=\"token keyword\">TRANSACTION</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">SELECT</span> <span class=\"token variable\">@A</span>:<span class=\"token operator\">=</span><span class=\"token function\">SUM</span><span class=\"token punctuation\">(</span>salary<span class=\"token punctuation\">)</span> <span class=\"token keyword\">FROM</span> table1 <span class=\"token keyword\">WHERE</span> <span class=\"token keyword\">type</span><span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">UPDATE</span> table2 <span class=\"token keyword\">SET</span> summary<span class=\"token operator\">=</span><span class=\"token variable\">@A</span> <span class=\"token keyword\">WHERE</span> <span class=\"token keyword\">type</span><span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">COMMIT</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>将 autocommit 设置关闭</h3>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SET</span> autocommit<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">UPDATE</span> test <span class=\"token keyword\">set</span> a<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>DDL 语句不能回滚</h3>\n<p>所有的数据定义语言(DDL) 语句是不可以回滚的。</p>\n<h3>隐式提交事务的语句</h3>\n<ul>\n<li>数据定义语言(DDL) 语句。\n例如：ALTER DATABASE, ALTER TABLE, CREATE INDEX, DROP INDEX 等。InnoDB 将 CREATE TABLE语句作为单个事务处理，这意味着来自用户的ROLLBACK不会撤销用户在该事务期间所做的 CREATE TABLE 语句。</li>\n<li>隐含地使用或者更改 <code class=\"language-text\">mysql</code> 中数据表的语句。\n例如：ALTER USER, CREATE USER, REVOKE, SET PASSWORD</li>\n<li>事务控制及锁表语句。\n例：BEGIN, LOCK TABLES, SET autocommit=1, START TRANSACTION, UNLOCK TABLES</li>\n<li>管理语句。\n例： ANALYZE TABLE, CACHE INDEX, CHECK TABLE, FLUSH, LOAD INDEX INTO CACHE, OPTIMIZE TABLE, REPAIR TABLE, RESET</li>\n<li>副本控制语句。\n例：START SLAVE, STOP SLAVE, RESET SLAVE, CHANGE MASTER TO</li>\n</ul>\n<h2>引用</h2>\n<ol>\n<li><a href=\"https://dev.mysql.com/doc/refman/5.7/en/sql-syntax-transactions.html\">START TRANSACTION, COMMIT, and ROLLBACK Syntax</a></li>\n</ol>","frontmatter":{"title":"MySQL 事务","date":"May 20, 2018","description":""}},"previous":{"fields":{"slug":"/archives/2018-05-18-process/"},"frontmatter":{"title":"Process"}},"next":{"fields":{"slug":"/archives/2018-07-12-openwrt-cross-gfw/"},"frontmatter":{"title":"OpenWrt Shadowsocks 配置指南"}}},"pageContext":{"id":"b8aa4f4c-94e5-564e-8846-3ca9414185a3","previousPostId":"cbb43f29-2157-5ac7-a40d-3cece12db92c","nextPostId":"0b33f5bf-448a-5c1c-a8e6-f46c0c630adb"}},"staticQueryHashes":["2841359383","3257411868"]}