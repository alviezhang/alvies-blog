{"componentChunkName":"component---src-templates-blog-post-js","path":"/archives/2015-08-27-lnmp-configuration/","result":{"data":{"site":{"siteMetadata":{"title":"Alvie's Blog"}},"markdownRemark":{"id":"4adc0f9e-9ed3-5af1-bdc4-245f18278480","excerpt":"安装Nginx、PHP 以 Archlinux 为例，安装命令如下: 配置 PHP PHP-fpm 接收 FastCGI 请求有两种方式，一种是通过端口，第二种是通过 unix socket 文件进行通信。在  可以配置： 这里采用了监听端口的方式。除此之外，还要配置 PHP 本身的配置文件，以支持 MySQL…","html":"<h3>安装Nginx、PHP</h3>\n<p>以 Archlinux 为例，安装命令如下:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S nginx php php-fpm</code></pre></div>\n<h3>配置 PHP</h3>\n<p>PHP-fpm 接收 FastCGI 请求有两种方式，一种是通过端口，第二种是通过 unix socket 文件进行通信。在 <code class=\"language-text\">/etc/php/php-fpm.conf</code> 可以配置：</p>\n<div class=\"gatsby-highlight\" data-language=\"conf\"><pre class=\"language-conf\"><code class=\"language-conf\">listen = 127.0.0.1:9000\n;listen = /run/php-fpm/php-fpm.sock</code></pre></div>\n<p>这里采用了监听端口的方式。除此之外，还要配置 PHP 本身的配置文件，以支持 MySQL 等扩展。编辑 <code class=\"language-text\">/etc/php/php.ini</code>，取消 <code class=\"language-text\">extension=mysql.so</code> 和 <code class=\"language-text\">extension=mysqli.so</code> 两行的注释。</p>\n<p>除此之外，还需查看 <code class=\"language-text\">php.ini</code> 文件中 <code class=\"language-text\">open_basedir</code> 中的值，如果 PHP 文件的路径在设置值之外，你需要把对应的父目录加入到 <code class=\"language-text\">open_basedir</code> 中。</p>\n<h3>配置Nginx</h3>\n<p>在给 Nginx 添加配置时，可以直接在 <code class=\"language-text\">/etc/nginx/nginx.conf</code> 中添加配置，也可以在这个配置文件中包含新的配置文件，这里采用后者。</p>\n<p>编辑 <code class=\"language-text\">/etc/nginx/nginx.conf</code>，在 <code class=\"language-text\">server</code> 段中添加如下内容：</p>\n<div class=\"gatsby-highlight\" data-language=\"conf\"><pre class=\"language-conf\"><code class=\"language-conf\">location / { \n    include        conf.d/ci.conf;\n}</code></pre></div>\n<p><code class=\"language-text\">conf.d/ci.conf</code> 为自定，然后编辑该文件，添加如下内容：</p>\n<div class=\"gatsby-highlight\" data-language=\"conf\"><pre class=\"language-conf\"><code class=\"language-conf\">root           /path/to/php/code;   # php代码的根路径\ntry_files      $uri $uri/ /index.php;\nindex          index.php index.html index.htm;\nfastcgi_pass   127.0.0.1:9000;\n# fastcgi_pass   unix:/run/php-fpm/php-fpm.sock;\nfastcgi_index  index.php;\nfastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;\ninclude        fastcgi_params;</code></pre></div>\n<p>其中 <code class=\"language-text\">fastcgi_pass</code> 配置由上一步的 PHP-fpm 配置决定。此外，最后两行可以换成 <code class=\"language-text\">include fastcgi.conf</code>。附上两个 fastcgi 文件内容。</p>\n<p><code class=\"language-text\">fastcgi_params</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"conf\"><pre class=\"language-conf\"><code class=\"language-conf\">fastcgi_param  QUERY_STRING       $query_string;\nfastcgi_param  REQUEST_METHOD     $request_method;\nfastcgi_param  CONTENT_TYPE       $content_type;\nfastcgi_param  CONTENT_LENGTH     $content_length;\n\nfastcgi_param  SCRIPT_NAME        $fastcgi_script_name;\nfastcgi_param  REQUEST_URI        $request_uri;\nfastcgi_param  DOCUMENT_URI       $document_uri;\nfastcgi_param  DOCUMENT_ROOT      $document_root;\nfastcgi_param  SERVER_PROTOCOL    $server_protocol;\nfastcgi_param  HTTPS              $https if_not_empty;\n\nfastcgi_param  GATEWAY_INTERFACE  CGI/1.1;\nfastcgi_param  SERVER_SOFTWARE    nginx/$nginx_version;\n\nfastcgi_param  REMOTE_ADDR        $remote_addr;\nfastcgi_param  REMOTE_PORT        $remote_port;\nfastcgi_param  SERVER_ADDR        $server_addr;\nfastcgi_param  SERVER_PORT        $server_port;\nfastcgi_param  SERVER_NAME        $server_name;\n\n# PHP only, required if PHP was built with --enable-force-cgi-redirect\nfastcgi_param  REDIRECT_STATUS    200;</code></pre></div>\n<p><code class=\"language-text\">fastcgi.conf</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"conf\"><pre class=\"language-conf\"><code class=\"language-conf\">fastcgi_param  SCRIPT_FILENAME    $document_root$fastcgi_script_name;\nfastcgi_param  QUERY_STRING       $query_string;\nfastcgi_param  REQUEST_METHOD     $request_method;\nfastcgi_param  CONTENT_TYPE       $content_type;\nfastcgi_param  CONTENT_LENGTH     $content_length;\n\nfastcgi_param  SCRIPT_NAME        $fastcgi_script_name;\nfastcgi_param  REQUEST_URI        $request_uri;\nfastcgi_param  DOCUMENT_URI       $document_uri;\nfastcgi_param  DOCUMENT_ROOT      $document_root;\nfastcgi_param  SERVER_PROTOCOL    $server_protocol;\nfastcgi_param  HTTPS              $https if_not_empty;\n\nfastcgi_param  GATEWAY_INTERFACE  CGI/1.1;\nfastcgi_param  SERVER_SOFTWARE    nginx/$nginx_version;\n\nfastcgi_param  REMOTE_ADDR        $remote_addr;\nfastcgi_param  REMOTE_PORT        $remote_port;\nfastcgi_param  SERVER_ADDR        $server_addr;\nfastcgi_param  SERVER_PORT        $server_port;\nfastcgi_param  SERVER_NAME        $server_name;\n\n# PHP only, required if PHP was built with --enable-force-cgi-redirect\nfastcgi_param  REDIRECT_STATUS    200;</code></pre></div>\n<p>可以看出来 <code class=\"language-text\">fastcgi.conf</code> 比 <code class=\"language-text\">fastcgi_params</code> 文件只多出第一行。</p>\n<h3>测试</h3>\n<p>在 Nginx 设置的 PHP 路径添加测试文件 <code class=\"language-text\">index.php</code>，重启 nginx 服务和 PHP-fpm 服务，测试下你的 PHP 服务吧。</p>","frontmatter":{"title":"Nginx、PHP 开发环境配置","date":"August 27, 2015","description":null}},"previous":{"fields":{"slug":"/archives/2015-07-27-vim-add-line-number/"},"frontmatter":{"title":"用VIM给文件添加行号"}},"next":{"fields":{"slug":"/archives/2015-09-09-osx-swap-fn-and-control/"},"frontmatter":{"title":"macOS 交换 Fn 键和 Control 键"}}},"pageContext":{"id":"4adc0f9e-9ed3-5af1-bdc4-245f18278480","previousPostId":"c98ca8c6-b55b-5951-add4-b74469ea71cb","nextPostId":"d389d6cb-85d4-5a10-8660-8ed4d658ba0e"}},"staticQueryHashes":["2841359383","3257411868"]}